# Resume Builder Module - Complete Technical Specification

## Module Overview

**Purpose**: AI-powered resume creation system optimized for formerly incarcerated individuals and second-chance employment opportunities.

**Core Value Proposition**: Transforms sparse work histories into compelling professional narratives while optimizing for ATS (Applicant Tracking System) compatibility and background-friendly employers.

---

## Database Architecture & Schema

### Primary Database: `resumes.db`

```sql
-- RESUME MASTER RECORDS
resumes (
    resume_id TEXT PRIMARY KEY,
    client_id TEXT NOT NULL,  -- FK to core_clients.clients
    template_type TEXT CHECK (template_type IN ('classic', 'modern', 'warehouse', 'construction', 'food_service', 'medical_social')),
    resume_title TEXT,
    content TEXT,  -- JSON formatted resume data
    pdf_path TEXT,  -- File system path to generated PDF
    ats_score INTEGER CHECK (ats_score BETWEEN 0 AND 100),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT 1
);

-- CLIENT PROFILE DATA
client_profiles (
    profile_id TEXT PRIMARY KEY,
    client_id TEXT NOT NULL,  -- FK to core_clients.clients
    work_history TEXT,  -- JSON array of work experience
    education TEXT,     -- JSON array of education records
    skills TEXT,        -- JSON array of skills
    certifications TEXT, -- JSON array of certifications
    references TEXT,    -- JSON array of references
    career_objective TEXT,
    preferred_industries TEXT, -- JSON array
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- RESUME TAILORING HISTORY
resume_tailoring (
    tailoring_id TEXT PRIMARY KEY,
    resume_id TEXT REFERENCES resumes(resume_id),
    job_title TEXT,
    company_name TEXT,
    job_description TEXT,
    tailored_content TEXT,  -- JSON of modified resume sections
    match_score DECIMAL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- TEMPLATE CONFIGURATIONS
resume_templates (
    template_id TEXT PRIMARY KEY,
    template_name TEXT,
    template_type TEXT,
    css_styles TEXT,
    section_order TEXT,  -- JSON array defining section sequence
    industry_focus TEXT,
    background_friendly BOOLEAN DEFAULT 1
);
```

### Cross-Database Relationships

```sql
-- Links to core_clients.db
client_id → core_clients.clients.client_id

-- Links to jobs.db  
resume_id → jobs.job_applications.resume_used

-- Links to services.db
client_id → services.client_referrals.client_id (employment services)
```

---

## API Endpoints & Data Contracts

### Core Resume Operations

#### 1. Resume Creation
```http
POST /api/resume/create
Content-Type: application/json

{
  "client_id": "uuid",
  "template_type": "modern",
  "resume_data": {
    "personal_info": {
      "first_name": "string",
      "last_name": "string", 
      "phone": "string",
      "email": "string",
      "address": "string"
    },
    "career_objective": "string",
    "work_experience": [
      {
        "job_title": "string",
        "company": "string", 
        "start_date": "YYYY-MM",
        "end_date": "YYYY-MM",
        "description": "string",
        "achievements": ["string"]
      }
    ],
    "education": [
      {
        "degree": "string",
        "institution": "string",
        "graduation_date": "YYYY",
        "gpa": "decimal"
      }
    ],
    "skills": [
      {
        "category": "string",
        "skill_list": ["string"]
      }
    ],
    "certifications": [
      {
        "name": "string",
        "issuer": "string", 
        "date_obtained": "YYYY-MM",
        "expiration_date": "YYYY-MM"
      }
    ]
  }
}

Response:
{
  "success": true,
  "resume_id": "uuid",
  "ats_score": 85,
  "pdf_url": "/api/resume/download/uuid"
}
```

#### 2. Resume Retrieval
```http
GET /api/resume/client/{client_id}

Response:
{
  "success": true,
  "resumes": [
    {
      "resume_id": "uuid",
      "template_type": "modern",
      "resume_title": "string",
      "ats_score": 85,
      "created_at": "ISO datetime",
      "is_active": true
    }
  ]
}
```

#### 3. AI Resume Tailoring
```http
POST /api/resume/tailor
Content-Type: application/json

{
  "resume_id": "uuid",
  "job_description": "string",
  "job_title": "string",
  "company_name": "string"
}

Response:
{
  "success": true,
  "tailored_resume": {
    "match_score": 92.5,
    "tailored_sections": {
      "career_objective": "string",
      "highlighted_skills": ["string"],
      "relevant_experience": ["string"]
    },
    "improvement_suggestions": ["string"]
  }
}
```

#### 4. PDF Generation & Download
```http
GET /api/resume/generate-pdf/{resume_id}

Response:
{
  "success": true,
  "pdf_url": "/api/resume/download/{resume_id}",
  "file_size": "string"
}

GET /api/resume/download/{resume_id}
Content-Type: application/pdf
Content-Disposition: attachment; filename="resume_{client_name}.pdf"
```

#### 5. Template Management
```http
GET /api/resume/templates

Response:
{
  "success": true,
  "templates": [
    {
      "template_id": "uuid",
      "template_name": "Modern Professional",
      "template_type": "modern",
      "industry_focus": "General",
      "background_friendly": true,
      "preview_image": "/static/templates/modern_preview.png"
    }
  ]
}
```

---

## Frontend Architecture

### Component Hierarchy
```
Resume.jsx (Main Container)
├── ResumeBuilder.jsx (Step-by-step wizard)
│   ├── TemplateSelector.jsx
│   ├── PersonalInfoForm.jsx
│   ├── WorkExperienceForm.jsx
│   ├── EducationForm.jsx
│   ├── SkillsForm.jsx
│   └── CertificationsForm.jsx
├── ResumePreview.jsx (Live preview)
├── ResumeDashboard.jsx (Client's resume list)
├── ResumeEditor.jsx (Edit existing resumes)
└── TailoringInterface.jsx (AI job matching)
```

### State Management
```javascript
// React Query Keys
const resumeKeys = {
  all: ['resumes'],
  client: (clientId) => ['resumes', 'client', clientId],
  detail: (resumeId) => ['resumes', 'detail', resumeId],
  templates: ['resume-templates'],
  tailoring: (resumeId, jobId) => ['resume-tailoring', resumeId, jobId]
};

// Core State Structure
const resumeState = {
  currentResume: {
    resume_id: null,
    client_id: null,
    template_type: null,
    content: {},
    ats_score: 0
  },
  templates: [],
  tailoringResults: null,
  isGeneratingPDF: false,
  previewMode: 'edit' // 'edit' | 'preview' | 'pdf'
};
```

### User Flow Sequences

#### 1. New Resume Creation Flow
```
1. Client Selection (if case manager) OR auto-detect logged client
2. Template Selection → TemplateSelector.jsx
3. Personal Information → PersonalInfoForm.jsx
4. Work Experience → WorkExperienceForm.jsx (special handling for gaps)
5. Education → EducationForm.jsx
6. Skills & Certifications → SkillsForm.jsx + CertificationsForm.jsx
7. AI Optimization → Automatic ATS scoring
8. Preview & Generate → ResumePreview.jsx + PDF generation
9. Save & Download → Database storage + file download
```

#### 2. Resume Tailoring Flow
```
1. Select Existing Resume → ResumeDashboard.jsx
2. Input Job Description → TailoringInterface.jsx
3. AI Analysis → POST /api/resume/tailor
4. Review Suggestions → Display match score & improvements
5. Apply Changes → Update resume content
6. Generate Tailored PDF → New PDF with optimizations
7. Track Application → Link to Jobs module
```

---

## AI Integration & Algorithms

### OpenAI API Integration
```python
# Resume Content Optimization
async def optimize_resume_content(resume_data, job_description=None):
    """
    Uses GPT-4 to optimize resume content for ATS and human readers
    """
    prompt = f"""
    Optimize this resume for second-chance employment:
    
    Resume Data: {json.dumps(resume_data)}
    Job Description: {job_description or "General employment"}
    
    Focus on:
    1. ATS keyword optimization
    2. Addressing employment gaps professionally  
    3. Highlighting transferable skills
    4. Background-friendly language
    5. Quantifiable achievements
    
    Return optimized sections with ATS score.
    """
    
    response = await openai.ChatCompletion.acreate(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}],
        temperature=0.3
    )
    
    return parse_optimization_response(response)

# ATS Scoring Algorithm
def calculate_ats_score(resume_content, job_description=None):
    """
    Calculates ATS compatibility score (0-100)
    """
    score_factors = {
        'keyword_density': 25,      # Job-relevant keywords
        'format_compliance': 20,    # ATS-readable format
        'section_completeness': 20, # All required sections
        'quantified_achievements': 15, # Numbers and metrics
        'skills_alignment': 10,     # Skills match
        'contact_info_quality': 10  # Complete contact details
    }
    
    return calculate_weighted_score(resume_content, score_factors)
```

### Job Matching Algorithm
```python
async def find_matching_jobs(resume_id, location=None, salary_min=None):
    """
    AI-powered job matching based on resume content
    """
    resume = await get_resume_by_id(resume_id)
    
    # Extract key skills and experience
    skills = extract_skills_from_resume(resume.content)
    experience_level = calculate_experience_level(resume.content)
    
    # Query job boards with background-friendly filter
    matching_jobs = await search_jobs(
        skills=skills,
        experience_level=experience_level,
        background_friendly=True,
        location=location,
        salary_min=salary_min
    )
    
    # Score each job match
    scored_jobs = []
    for job in matching_jobs:
        match_score = calculate_job_match_score(resume.content, job)
        scored_jobs.append({
            'job': job,
            'match_score': match_score,
            'tailoring_suggestions': generate_tailoring_tips(resume, job)
        })
    
    return sorted(scored_jobs, key=lambda x: x['match_score'], reverse=True)
```

---

## Cross-Module Integration Points

### 1. Case Management Integration
```python
# Auto-populate from client intake
def create_resume_from_client_data(client_id):
    client = get_client_from_case_management(client_id)
    
    return {
        'personal_info': {
            'first_name': client.first_name,
            'last_name': client.last_name,
            'phone': client.phone,
            'email': client.email,
            'address': client.address
        },
        'career_objective': generate_objective_from_goals(client.goals),
        'work_experience': parse_work_history(client.employment_history)
    }
```

### 2. Jobs Module Integration
```python
# Link resume to job applications
async def apply_to_job_with_resume(job_id, resume_id, client_id):
    # Tailor resume for specific job
    tailored_resume = await tailor_resume_for_job(resume_id, job_id)
    
    # Create job application record
    application = await create_job_application({
        'job_id': job_id,
        'client_id': client_id,
        'resume_id': resume_id,
        'tailored_resume_id': tailored_resume.id,
        'application_status': 'submitted'
    })
    
    # Generate tracking reminder
    await create_follow_up_reminder(application.id)
    
    return application
```

### 3. Services Integration
```python
# Connect to employment services
def recommend_employment_services(client_id, resume_analysis):
    services = []
    
    if resume_analysis['skills_gap']:
        services.extend(get_training_programs(resume_analysis['missing_skills']))
    
    if resume_analysis['interview_prep_needed']:
        services.extend(get_interview_coaching_services())
    
    if resume_analysis['professional_attire_needed']:
        services.extend(get_clothing_assistance_programs())
    
    return services
```

### 4. Legal Integration
```python
# Handle background disclosure recommendations
def generate_background_disclosure_guidance(client_id):
    legal_cases = get_client_legal_history(client_id)
    
    if legal_cases:
        return {
            'disclosure_timing': 'after_interview',
            'recommended_approach': generate_disclosure_script(legal_cases),
            'legal_resources': get_expungement_info(client_id)
        }
    
    return None
```

---

## File Handling & PDF Generation

### PDF Generation System
```python
from weasyprint import HTML, CSS
from jinja2 import Template

class ResumeRenderer:
    def __init__(self):
        self.template_dir = 'templates/resume/'
        self.output_dir = 'static/resumes/'
    
    async def generate_pdf(self, resume_id):
        resume = await get_resume_by_id(resume_id)
        template_path = f"{self.template_dir}{resume.template_type}.html"
        
        # Load template
        with open(template_path, 'r') as f:
            template = Template(f.read())
        
        # Render HTML
        html_content = template.render(
            resume_data=json.loads(resume.content),
            generated_date=datetime.now().strftime('%B %Y')
        )
        
        # Generate PDF
        pdf_filename = f"resume_{resume.client_id}_{resume_id}.pdf"
        pdf_path = f"{self.output_dir}{pdf_filename}"
        
        HTML(string=html_content).write_pdf(
            pdf_path,
            stylesheets=[CSS(f"{self.template_dir}styles/{resume.template_type}.css")]
        )
        
        # Update database with file path
        await update_resume_pdf_path(resume_id, pdf_path)
        
        return pdf_path

# File Storage Structure
/static/resumes/
├── resume_{client_id}_{resume_id}.pdf
├── tailored_{resume_id}_{job_id}.pdf
└── templates/
    ├── classic.html
    ├── modern.html
    ├── warehouse.html
    └── styles/
        ├── classic.css
        ├── modern.css
        └── warehouse.css
```

### Template System
```html
<!-- Example: templates/resume/modern.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{{ resume_data.personal_info.first_name }} {{ resume_data.personal_info.last_name }} - Resume</title>
    <link rel="stylesheet" href="styles/modern.css">
</head>
<body>
    <div class="resume-container">
        <!-- Header Section -->
        <header class="resume-header">
            <h1>{{ resume_data.personal_info.first_name }} {{ resume_data.personal_info.last_name }}</h1>
            <div class="contact-info">
                <span>{{ resume_data.personal_info.phone }}</span>
                <span>{{ resume_data.personal_info.email }}</span>
                <span>{{ resume_data.personal_info.address }}</span>
            </div>
        </header>
        
        <!-- Career Objective -->
        {% if resume_data.career_objective %}
        <section class="objective">
            <h2>Professional Summary</h2>
            <p>{{ resume_data.career_objective }}</p>
        </section>
        {% endif %}
        
        <!-- Work Experience -->
        {% if resume_data.work_experience %}
        <section class="experience">
            <h2>Professional Experience</h2>
            {% for job in resume_data.work_experience %}
            <div class="job-entry">
                <div class="job-header">
                    <h3>{{ job.job_title }}</h3>
                    <span class="company">{{ job.company }}</span>
                    <span class="dates">{{ job.start_date }} - {{ job.end_date or 'Present' }}</span>
                </div>
                <p class="job-description">{{ job.description }}</p>
                {% if job.achievements %}
                <ul class="achievements">
                    {% for achievement in job.achievements %}
                    <li>{{ achievement }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
            {% endfor %}
        </section>
        {% endif %}
        
        <!-- Skills Section -->
        {% if resume_data.skills %}
        <section class="skills">
            <h2>Core Competencies</h2>
            {% for skill_category in resume_data.skills %}
            <div class="skill-group">
                <strong>{{ skill_category.category }}:</strong>
                <span>{{ skill_category.skill_list | join(', ') }}</span>
            </div>
            {% endfor %}
        </section>
        {% endif %}
        
        <!-- Education -->
        {% if resume_data.education %}
        <section class="education">
            <h2>Education</h2>
            {% for edu in resume_data.education %}
            <div class="education-entry">
                <strong>{{ edu.degree }}</strong>
                <span>{{ edu.institution }}, {{ edu.graduation_date }}</span>
                {% if edu.gpa and edu.gpa >= 3.5 %}
                <span class="gpa">GPA: {{ edu.gpa }}</span>
                {% endif %}
            </div>
            {% endfor %}
        </section>
        {% endif %}
    </div>
</body>
</html>
```

---

## Testing Requirements

### Unit Tests Required

#### 1. Database Operations
```python
def test_resume_creation():
    # Test resume record creation
    # Test client profile creation
    # Test foreign key relationships
    # Test JSON field validation

def test_resume_retrieval():
    # Test get by client_id
    # Test get by resume_id
    # Test filtering and sorting

def test_resume_updates():
    # Test content updates
    # Test template changes
    # Test ATS score recalculation
```

#### 2. API Endpoints
```python
def test_create_resume_endpoint():
    # Test valid resume creation
    # Test missing required fields
    # Test invalid template type
    # Test client_id validation

def test_tailor_resume_endpoint():
    # Test job description processing
    # Test AI response handling
    # Test score calculation
    # Test content modification

def test_pdf_generation_endpoint():
    # Test PDF creation
    # Test file system storage
    # Test download functionality
    # Test error handling for missing data
```

#### 3. AI Integration
```python
def test_ats_scoring_algorithm():
    # Test keyword detection
    # Test format compliance scoring
    # Test section completeness validation
    # Test score calculation accuracy

def test_job_matching():
    # Test skill extraction
    # Test job query generation
    # Test match score calculation
    # Test background-friendly filtering
```

#### 4. Cross-Module Integration
```python
def test_case_management_integration():
    # Test client data import
    # Test goal-to-objective conversion
    # Test data synchronization

def test_jobs_module_integration():
    # Test job application creation
    # Test resume-job linking
    # Test application tracking

def test_services_integration():
    # Test service recommendations
    # Test employment service referrals
```

#### 5. File Operations
```python
def test_pdf_generation():
    # Test HTML template rendering
    # Test CSS styling application
    # Test PDF file creation
    # Test file path storage

def test_file_download():
    # Test PDF serving
    # Test file permissions
    # Test error handling for missing files
```

### Integration Tests
```python
def test_complete_resume_workflow():
    """End-to-end test of full resume creation process"""
    # Create client
    # Build resume through all steps
    # Generate PDF
    # Tailor for job
    # Apply to job
    # Verify all data relationships

def test_multi_client_resume_management():
    """Test case manager handling multiple client resumes"""
    # Create multiple clients
    # Create resumes for each
    # Test data isolation
    # Test bulk operations
```

### Performance Tests
```python
def test_pdf_generation_performance():
    # Test generation speed for different templates
    # Test concurrent PDF generation
    # Test large resume handling

def test_ai_response_times():
    # Test OpenAI API response times
    # Test timeout handling
    # Test rate limiting
```

---

## Error Handling & Edge Cases

### Common Failure Scenarios
```python
# 1. Missing Client Data
def handle_incomplete_client_profile():
    # Graceful degradation when client data is sparse
    # Prompt for additional information
    # Use AI to suggest content improvements

# 2. AI Service Failures
def handle_openai_api_failure():
    # Fallback to template-based content
    # Retry logic with exponential backoff
    # User notification of reduced functionality

# 3. PDF Generation Failures
def handle_pdf_generation_error():
    # Template validation before generation
    # Error logging and user notification
    # Fallback to HTML preview

# 4. File System Issues
def handle_storage_errors():
    # Check disk space before PDF generation
    # Implement file cleanup for old resumes
    # Handle permission errors gracefully
```

### Data Validation
```python
# Resume Content Validation
resume_schema = {
    "personal_info": {
        "required": ["first_name", "last_name", "phone", "email"],
        "validation": {
            "email": "email_format",
            "phone": "phone_format"
        }
    },
    "work_experience": {
        "validation": {
            "start_date": "date_format",
            "end_date": "date_format_or_null"
        }
    },
    "education": {
        "validation": {
            "graduation_date": "year_format",
            "gpa": "decimal_range_0_4"
        }
    }
}
```

---

## Rebuild Specifications

### Critical Components (Priority Order)

#### 1. Database Schema (MUST WORK)
- `resumes` table with proper foreign keys
- `client_profiles` table for resume data
- JSON field handling for complex data structures
- Proper indexing for performance

#### 2. Core API Endpoints (MUST WORK)
- `POST /api/resume/create` - Resume creation
- `GET /api/resume/client/{client_id}` - Client resumes
- `GET /api/resume/generate-pdf/{resume_id}` - PDF generation
- `POST /api/resume/tailor` - AI tailoring

#### 3. Frontend Components (MUST WORK)
- Resume creation wizard with all form steps
- Template selection interface
- Resume preview with live updates
- PDF download functionality

#### 4. AI Integration (NICE TO HAVE)
- OpenAI API integration for content optimization
- ATS scoring algorithm
- Job matching recommendations

#### 5. Cross-Module Links (NICE TO HAVE)
- Case management integration
- Jobs module connection
- Services recommendations

### Success Criteria
- ✅ User can create a complete resume
- ✅ Resume saves to client profile in database
- ✅ PDF generates and downloads successfully
- ✅ Multiple templates work correctly
- ✅ Resume data persists across sessions
- ✅ Integration with client selection works
- ✅ No console errors during normal operation

This resume builder is a sophisticated module with AI integration, multiple database relationships, and complex file generation. Test every component thoroughly!